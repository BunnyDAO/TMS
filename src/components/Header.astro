---
import { categories, categoryKeys } from '../data/categories';

const currentPath = Astro.url.pathname;

const colorClasses = {
  violet: 'hover:text-violet-400',
  orange: 'hover:text-orange-400',
  blue: 'hover:text-blue-400',
  teal: 'hover:text-teal-400',
  emerald: 'hover:text-emerald-400',
  cyan: 'hover:text-cyan-400',
} as Record<string, string>;

const activeClasses = {
  violet: 'text-violet-400 border-violet-500/50',
  orange: 'text-orange-400 border-orange-500/50',
  blue: 'text-blue-400 border-blue-500/50',
  teal: 'text-teal-400 border-teal-400/50',
  emerald: 'text-emerald-400 border-emerald-500/50',
  cyan: 'text-cyan-400 border-cyan-500/50',
} as Record<string, string>;

const dotColors = {
  violet: 'bg-violet-500',
  orange: 'bg-orange-500',
  blue: 'bg-blue-500',
  teal: 'bg-teal-400',
  emerald: 'bg-emerald-500',
  cyan: 'bg-cyan-500',
} as Record<string, string>;
---

<header class="sticky top-0 z-50 border-b border-slate-800/50 bg-slate-950/90 backdrop-blur-xl">
  <div class="mx-auto flex max-w-7xl items-center justify-between px-4 py-3 sm:px-6 lg:px-8">
    <!-- Logo -->
    <a href="/" class="group flex items-center gap-2">
      <span class="font-mono text-lg font-black tracking-tighter text-white transition-colors group-hover:text-violet-400">TMS</span>
      <span class="hidden font-mono text-[10px] text-slate-700 sm:inline">v1.0</span>
    </a>

    <!-- Desktop nav -->
    <nav class="hidden items-center gap-0.5 md:flex">
      {categoryKeys.map((key) => {
        const cat = categories[key];
        const isActive = currentPath.includes(`/category/${key}`);
        return (
          <a
            href={`/category/${key}`}
            class:list={[
              'group relative flex items-center gap-1.5 rounded-lg px-2.5 py-1.5 font-mono text-xs font-medium transition-all',
              isActive
                ? activeClasses[cat.color]
                : `text-slate-600 ${colorClasses[cat.color]}`,
            ]}
          >
            <span class:list={[
              'inline-block h-1.5 w-1.5 rounded-full transition-opacity',
              dotColors[cat.color],
              isActive ? 'opacity-100' : 'opacity-0 group-hover:opacity-50',
            ]}></span>
            {cat.name}
          </a>
        );
      })}
      <!-- Map link -->
      <a
        href="/ecosystem"
        class:list={[
          'group relative flex items-center gap-1.5 rounded-lg px-2.5 py-1.5 font-mono text-xs font-medium transition-all',
          currentPath.includes('/ecosystem')
            ? 'text-slate-300 border-slate-500/50'
            : 'text-slate-600 hover:text-slate-400',
        ]}
      >
        <svg class="h-3 w-3" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="3" />
          <circle cx="4" cy="6" r="2" />
          <circle cx="20" cy="6" r="2" />
          <circle cx="4" cy="18" r="2" />
          <circle cx="20" cy="18" r="2" />
          <line x1="6" y1="7" x2="9" y2="10" />
          <line x1="18" y1="7" x2="15" y2="10" />
          <line x1="6" y1="17" x2="9" y2="14" />
          <line x1="18" y1="17" x2="15" y2="14" />
        </svg>
        Map
      </a>
      <!-- Submit link -->
      <a
        href="/submit"
        class:list={[
          'group relative flex items-center gap-1.5 rounded-lg px-2.5 py-1.5 font-mono text-xs font-medium transition-all',
          currentPath.includes('/submit')
            ? 'text-violet-400 border-violet-500/50'
            : 'text-slate-600 hover:text-violet-400',
        ]}
      >
        Submit
      </a>
    </nav>

    <div class="flex items-center gap-2">
      <!-- Search -->
      <a
        href="/search"
        class="group flex items-center gap-2 rounded-lg border border-slate-800/50 bg-slate-900/50 px-3 py-1.5 font-mono text-xs text-slate-600 transition-all hover:border-slate-700 hover:text-slate-400"
        aria-label="Search"
      >
        <svg class="h-3.5 w-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
        </svg>
        <span class="hidden sm:inline">search</span>
        <kbd class="hidden rounded border border-slate-800 bg-slate-900 px-1 py-0.5 text-[9px] text-slate-700 sm:inline">/</kbd>
      </a>

      <!-- Mobile menu button -->
      <button
        id="mobile-menu-btn"
        class="rounded-lg border border-slate-800/50 p-1.5 text-slate-600 transition-colors hover:border-slate-700 hover:text-white md:hidden"
        aria-label="Toggle menu"
        aria-expanded="false"
        aria-controls="mobile-menu"
      >
        <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M4 6h16M4 12h16M4 18h16" />
        </svg>
      </button>
    </div>
  </div>

  <!-- Mobile menu -->
  <div id="mobile-menu" class="max-h-0 overflow-hidden border-t border-slate-800/50 bg-slate-950/95 backdrop-blur-xl transition-[max-height] duration-300 ease-in-out md:hidden">
    <nav class="mx-auto max-w-7xl space-y-0.5 px-4 py-3 sm:px-6">
      {categoryKeys.map((key) => {
        const cat = categories[key];
        return (
          <a
            href={`/category/${key}`}
            class:list={[
              'flex items-center gap-2.5 rounded-lg px-3 py-2.5 font-mono text-sm text-slate-500 transition-colors',
              colorClasses[cat.color],
            ]}
          >
            <span class:list={['inline-block h-1.5 w-1.5 rounded-full', dotColors[cat.color]]}></span>
            {cat.name}
          </a>
        );
      })}
      <div class="border-t border-slate-800/50 pt-2">
        <a
          href="/submit"
          class="flex items-center gap-2.5 rounded-lg px-3 py-2.5 font-mono text-sm text-slate-500 transition-colors hover:text-violet-400"
        >
          <span class="font-mono text-base">+</span>
          submit a tool
        </a>
        <a
          href="/ecosystem"
          class="flex items-center gap-2.5 rounded-lg px-3 py-2.5 font-mono text-sm text-slate-500 transition-colors hover:text-white"
        >
          <svg class="h-3.5 w-3.5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="3" />
            <circle cx="4" cy="6" r="2" />
            <circle cx="20" cy="6" r="2" />
            <circle cx="4" cy="18" r="2" />
            <circle cx="20" cy="18" r="2" />
            <line x1="6" y1="7" x2="9" y2="10" />
            <line x1="18" y1="7" x2="15" y2="10" />
            <line x1="6" y1="17" x2="9" y2="14" />
            <line x1="18" y1="17" x2="15" y2="14" />
          </svg>
          ecosystem map
        </a>
        <a
          href="/search"
          class="flex items-center gap-2.5 rounded-lg px-3 py-2.5 font-mono text-sm text-slate-500 transition-colors hover:text-white"
        >
          <svg class="h-3.5 w-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
          </svg>
          search
        </a>
      </div>
    </nav>
  </div>
</header>

<script>
  const btn = document.getElementById('mobile-menu-btn');
  const menu = document.getElementById('mobile-menu');

  function openMenu() {
    menu?.classList.remove('max-h-0');
    menu?.classList.add('max-h-screen');
    btn?.setAttribute('aria-expanded', 'true');
  }

  function closeMenu() {
    menu?.classList.add('max-h-0');
    menu?.classList.remove('max-h-screen');
    btn?.setAttribute('aria-expanded', 'false');
  }

  function isOpen() {
    return menu?.classList.contains('max-h-screen');
  }

  btn?.addEventListener('click', () => {
    isOpen() ? closeMenu() : openMenu();
  });

  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape' && isOpen()) closeMenu();
  });

  document.addEventListener('click', (e) => {
    const target = e.target as Node;
    if (isOpen() && !menu?.contains(target) && !btn?.contains(target)) {
      closeMenu();
    }
  });
</script>
