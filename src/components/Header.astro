---
import { categories, categoryKeys } from '../data/categories';

const currentPath = Astro.url.pathname;

const colorClasses = {
  violet: 'hover:text-violet-400',
  orange: 'hover:text-orange-400',
  blue: 'hover:text-blue-400',
  green: 'hover:text-green-400',
  rose: 'hover:text-rose-400',
  slate: 'hover:text-slate-400',
} as Record<string, string>;

const activeClasses = {
  violet: 'text-violet-400 border-violet-500/50',
  orange: 'text-orange-400 border-orange-500/50',
  blue: 'text-blue-400 border-blue-500/50',
  green: 'text-green-400 border-green-400/50',
  rose: 'text-rose-400 border-rose-500/50',
  slate: 'text-slate-400 border-slate-400/50',
} as Record<string, string>;

const activePillClasses = {
  violet: 'bg-violet-500/20 text-violet-400 border-violet-500/30',
  orange: 'bg-orange-500/20 text-orange-400 border-orange-500/30',
  blue: 'bg-blue-500/20 text-blue-400 border-blue-500/30',
  green: 'bg-green-400/20 text-green-400 border-green-400/30',
  rose: 'bg-rose-500/20 text-rose-400 border-rose-500/30',
  slate: 'bg-slate-400/20 text-slate-400 border-slate-400/30',
} as Record<string, string>;

const dotColors = {
  violet: 'bg-violet-500',
  orange: 'bg-orange-500',
  blue: 'bg-blue-500',
  green: 'bg-green-400',
  rose: 'bg-rose-500',
  slate: 'bg-slate-400',
} as Record<string, string>;
---

<header class="sticky top-0 z-50 border-b border-slate-800/50 bg-slate-950/90 backdrop-blur-xl">
  <div class="mx-auto flex max-w-7xl items-center justify-between px-4 py-3 sm:px-6 lg:px-8">
    <!-- Logo -->
    <a href="/" class="group flex items-center gap-2">
      <span class="font-mono text-lg font-black tracking-tighter text-white transition-colors group-hover:text-violet-400">toomuch.sh</span>
    </a>

    <!-- Desktop nav -->
    <nav class="hidden items-center gap-0.5 md:flex">
      <!-- Bubble Maps link -->
      <a
        href="/ecosystem"
        class:list={[
          'group relative flex items-center gap-1.5 rounded-lg px-2.5 py-1.5 font-mono text-xs font-medium transition-all',
          currentPath.includes('/ecosystem')
            ? 'text-slate-300 border-slate-500/50'
            : 'text-slate-600 hover:text-slate-400 nav-bubble-glow',
        ]}
      >
        <svg class="h-3 w-3" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="3" />
          <circle cx="4" cy="6" r="2" />
          <circle cx="20" cy="6" r="2" />
          <circle cx="4" cy="18" r="2" />
          <circle cx="20" cy="18" r="2" />
          <line x1="6" y1="7" x2="9" y2="10" />
          <line x1="18" y1="7" x2="15" y2="10" />
          <line x1="6" y1="17" x2="9" y2="14" />
          <line x1="18" y1="17" x2="15" y2="14" />
        </svg>
        Bubble Maps
      </a>
      <span class="mx-1 h-3 w-px bg-slate-800"></span>
      {categoryKeys.map((key) => {
        const cat = categories[key];
        const isActive = currentPath.includes(`/category/${key}`);
        return (
          <a
            href={`/category/${key}`}
            class:list={[
              'group relative flex items-center gap-1.5 rounded-lg px-2.5 py-1.5 font-mono text-xs font-medium transition-all',
              isActive
                ? activeClasses[cat.color]
                : `text-slate-600 ${colorClasses[cat.color]}`,
            ]}
          >
            <span class:list={[
              'inline-block h-1.5 w-1.5 rounded-full transition-opacity',
              dotColors[cat.color],
              isActive ? 'opacity-100' : 'opacity-0 group-hover:opacity-50',
            ]}></span>
            {cat.name}
          </a>
        );
      })}
      <!-- Submit link -->
      <a
        href="/submit"
        class:list={[
          'group relative flex items-center gap-1.5 rounded-lg px-2.5 py-1.5 font-mono text-xs font-medium transition-all',
          currentPath.includes('/submit')
            ? 'text-violet-400 border-violet-500/50'
            : 'text-slate-600 hover:text-violet-400',
        ]}
      >
        Submit
      </a>
    </nav>

    <div class="flex items-center gap-2">
      <!-- Search -->
      <a
        href="/search"
        class="group flex items-center gap-2 rounded-lg border border-slate-800/50 bg-slate-900/50 px-3 py-1.5 font-mono text-xs text-slate-600 transition-all hover:border-slate-700 hover:text-slate-400"
        aria-label="Search"
      >
        <svg class="h-3.5 w-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
        </svg>
        <span class="hidden sm:inline">search</span>
        <kbd class="hidden rounded border border-slate-800 bg-slate-900 px-1 py-0.5 text-[9px] text-slate-700 sm:inline">/</kbd>
      </a>
    </div>
  </div>

  <!-- Mobile pill bar -->
  <div class="relative border-t border-slate-800/50 bg-slate-900/50 md:hidden">
    <!-- Right fade + scroll hint -->
    <div id="pill-fade" class="pointer-events-none absolute right-0 top-0 z-10 flex h-full w-16 items-center justify-end bg-gradient-to-l from-slate-900 via-slate-900/80 to-transparent pr-2 transition-opacity duration-200">
      <svg id="scroll-hint" class="h-4 w-4 animate-bounce-x text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
      </svg>
    </div>
  <nav id="mobile-pill-nav" class="scrollbar-hide flex items-center gap-1.5 overflow-x-auto px-4 py-2" aria-label="Mobile navigation">
    <!-- Bubble Maps pill -->
    <a
      href="/ecosystem"
      class:list={[
        'flex shrink-0 items-center gap-1.5 rounded-full border px-3 py-1.5 font-mono text-[11px] font-medium transition-all',
        currentPath.includes('/ecosystem')
          ? 'bg-slate-700/30 text-white border-slate-600/50'
          : 'border-slate-800/50 text-slate-500 hover:text-slate-300 nav-bubble-glow',
      ]}
    >
      <svg class="h-3 w-3" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <circle cx="12" cy="12" r="3" />
        <circle cx="4" cy="6" r="2" />
        <circle cx="20" cy="6" r="2" />
        <circle cx="4" cy="18" r="2" />
        <circle cx="20" cy="18" r="2" />
        <line x1="6" y1="7" x2="9" y2="10" />
        <line x1="18" y1="7" x2="15" y2="10" />
        <line x1="6" y1="17" x2="9" y2="14" />
        <line x1="18" y1="17" x2="15" y2="14" />
      </svg>
      Bubbles
    </a>

    <span class="h-3 w-px shrink-0 bg-slate-800"></span>

    <!-- Category pills -->
    {categoryKeys.map((key) => {
      const cat = categories[key];
      const isActive = currentPath.includes(`/category/${key}`);
      return (
        <a
          href={`/category/${key}`}
          class:list={[
            'flex shrink-0 items-center gap-1.5 rounded-full border px-3 py-1.5 font-mono text-[11px] font-medium transition-all',
            isActive
              ? activePillClasses[cat.color]
              : `border-slate-800/50 text-slate-500 ${colorClasses[cat.color]}`,
          ]}
        >
          <span class:list={['inline-block h-1.5 w-1.5 rounded-full', dotColors[cat.color]]}></span>
          {cat.name}
        </a>
      );
    })}

    <!-- Submit pill -->
    <a
      href="/submit"
      class:list={[
        'flex shrink-0 items-center gap-1 rounded-full border px-3 py-1.5 font-mono text-[11px] font-medium transition-all',
        currentPath.includes('/submit')
          ? 'bg-violet-500/20 text-violet-400 border-violet-500/30'
          : 'border-slate-800/50 text-slate-500 hover:text-violet-400',
      ]}
    >
      + Submit
    </a>
  </nav>
  </div>
</header>

<style>
  .scrollbar-hide {
    -ms-overflow-style: none;
    scrollbar-width: none;
  }
  .scrollbar-hide::-webkit-scrollbar {
    display: none;
  }
  @keyframes bounce-x {
    0%, 100% { transform: translateX(0); }
    50% { transform: translateX(4px); }
  }
  .animate-bounce-x {
    animation: bounce-x 1.2s ease-in-out infinite;
  }
</style>

<script>
  const pillNav = document.querySelector('#mobile-pill-nav') as HTMLElement | null;
  const scrollHint = document.querySelector('#scroll-hint') as HTMLElement | null;
  const fadeOverlay = document.querySelector('#pill-fade') as HTMLElement | null;

  function updateFade() {
    if (!pillNav || !fadeOverlay) return;
    const atEnd = pillNav.scrollLeft + pillNav.clientWidth >= pillNav.scrollWidth - 2;
    fadeOverlay.style.opacity = atEnd ? '0' : '1';
    if (scrollHint && pillNav.scrollLeft > 0) {
      scrollHint.classList.add('opacity-0');
      scrollHint.classList.remove('animate-bounce-x');
    }
  }

  pillNav?.addEventListener('scroll', updateFade);
  updateFade();
</script>
